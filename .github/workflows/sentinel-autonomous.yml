name: Digital Sentinel v11 â€“ Eternal Autonomous Mode

on:
  workflow_dispatch:

jobs:
  recon-cycle:
    runs-on: ubuntu-latest
    timeout-minutes: 180   # â±ï¸ 3 hours runtime

    steps:
    - name: ðŸ“¦ Checkout Repository
      uses: actions/checkout@v4

    - name: ðŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: ðŸ§° Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt || true

    - name: ðŸš€ Launch Main Controller
      run: |
        echo ">>> Launching main controller..."
        export PYTHONPATH=$PYTHONPATH:$(pwd)/src
        python3 src/main_controller_v11.py

    - name: ðŸ§  Launch Sentinel Eternal Hunter
      run: |
        echo ">>> Starting sentinel_eternal_hunter.py"
        export PYTHONPATH=$PYTHONPATH:$(pwd)/src
        python3 src/sentinel_eternal_hunter.py

    - name: ðŸª¶ Upload Logs & Reports
      uses: actions/upload-artifact@v4
      with:
        name: digital-sentinel-v11-reports
        path: |
          data/logs/
          data/reports/

    - name: ðŸ›°ï¸ Send Discord Summary
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      run: |
        echo ">>> Sending mission summary to Discord..."
        export PYTHONPATH=$PYTHONPATH:$(pwd)/src
        python3 src/discord_notify.py "Cycle Complete" "Sentinel v11 autonomous mode finished successfully âœ…"

    - name: âœ… Complete Sentinel Cycle
      run: echo "ðŸŽ¯ Sentinel cycle completed successfully at $(date)"

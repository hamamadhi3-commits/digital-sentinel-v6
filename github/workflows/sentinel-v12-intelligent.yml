name: ğŸ¤– Digital Sentinel Quantum Autonomous v12
on:
  schedule:
    - cron: "0 */12 * * *"   # ğŸ•› Ú©Ø§Ø±Ø¯Û•Ú©Ø§Øª Ø¯ÙˆÙˆØ¬Ø§Ø± Ù„Û• Ú•Û†Ú˜ (Ù‡Û•Ù…ÙˆÙˆ 12 Ú©Ø§ØªÚ˜Ù…ÛØ±)
  workflow_dispatch:

jobs:
  launch-sentinel-v12:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ§  Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: ğŸ§° Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || true

      # ========== Stage 1: Target Intelligence ==========
      - name: ğŸŒ Update Target Intelligence Feed
        run: |
          echo "=========================================="
          echo "ğŸŒ Stage 1: Fetching 500+ Authorized Targets"
          echo "=========================================="
          python src/intel_feed_generator.py

      # ========== Stage 2: AI Priority Sorting ==========
      - name: ğŸ§  AI Priority Sorting
        run: |
          echo "=========================================="
          echo "ğŸ§  Stage 2: Prioritizing Targets by Bounty + Rank"
          echo "=========================================="
          python src/ai_priority_sorter.py

      # ========== Stage 3: Main Quantum Controller ==========
      - name: ğŸš€ Launch Main Quantum Controller
        run: |
          echo "=========================================="
          echo "ğŸš€ Stage 3: Running Digital Sentinel Quantum Controller v12"
          echo "=========================================="
          python src/main_controller_v11_4_quantum.py

      # ========== Stage 4: Upload Logs ==========
      - name: ğŸ“¤ Upload Sentinel Logs
        uses: actions/upload-artifact@v4
        with:
          name: sentinel-logs
          path: data/results/

      # ========== Stage 5: Discord Report ==========
      - name: ğŸ“¡ Dispatch Discord Report
        if: always()
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          echo "=========================================="
          echo "ğŸ“¡ Sending Report to Discord..."
          echo "=========================================="
          python src/discord_reporter.py || echo "âš ï¸ Discord reporter failed, skipping."

      # ========== Stage 6: Watchdog Self-Relaunch ==========
      - name: ğŸº Watchdog Auto-Relaunch
        run: |
          echo "ğŸº Watchdog active â€” Sentinel Quantum v12 will relaunch in 12 hours."
